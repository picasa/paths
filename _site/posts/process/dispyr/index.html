<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Pierre Casadebaig">
<meta name="dcterms.date" content="2022-11-25">
<title>Paths - Dispyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="../../../styles.css">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Paths</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/picasa"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/pircasa"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Dispyr</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Pierre Casadebaig </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 25, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#aims-and-inspiration" id="toc-aims-and-inspiration" class="nav-link active" data-scroll-target="#aims-and-inspiration">Aims and inspiration</a></li>
  <li>
<a href="#features-generation" id="toc-features-generation" class="nav-link" data-scroll-target="#features-generation">Features generation</a>
  <ul class="collapse">
<li><a href="#location" id="toc-location" class="nav-link" data-scroll-target="#location">Location</a></li>
  <li><a href="#rendering-style" id="toc-rendering-style" class="nav-link" data-scroll-target="#rendering-style">Rendering style</a></li>
  </ul>
</li>
  <li>
<a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing">Data processing</a>
  <ul class="collapse">
<li><a href="#getting-a-realistic-description-of-the-landscape" id="toc-getting-a-realistic-description-of-the-landscape" class="nav-link" data-scroll-target="#getting-a-realistic-description-of-the-landscape">Getting a realistic description of the landscape</a></li>
  <li><a href="#slicing-the-landscape-into-lines" id="toc-slicing-the-landscape-into-lines" class="nav-link" data-scroll-target="#slicing-the-landscape-into-lines">Slicing the landscape into lines</a></li>
  <li><a href="#altering-the-lines-with-noise-and-deletion" id="toc-altering-the-lines-with-noise-and-deletion" class="nav-link" data-scroll-target="#altering-the-lines-with-noise-and-deletion">Altering the lines with noise and deletion</a></li>
  </ul>
</li>
  <li><a href="#rendering" id="toc-rendering" class="nav-link" data-scroll-target="#rendering">Rendering</a></li>
  <li><a href="#iterations" id="toc-iterations" class="nav-link" data-scroll-target="#iterations">Iterations</a></li>
  </ul></nav>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><section id="aims-and-inspiration" class="level2"><h2 class="anchored" data-anchor-id="aims-and-inspiration">Aims and inspiration</h2>
<p>This work is an attempt to emulate etching drawings with code, by playing with noise and data removal to create a natural rendering of random fragments of the Pyrénées.</p>
<p>I was searching for an hybrid between the simplicity and efficiency of a famous data visualization in <a href="https://blogs.scientificamerican.com/sa-visual/pop-culture-pulsar-origin-story-of-joy-division-s-unknown-pleasures-album-cover-video/">astronomy</a> and the impressive Meridian <a href="https://opensea.io/collection/meridian-by-matt-deslauriers">serie</a> by Matt Deslauriers. Moreover, to be able to use a pen-plotter to trace the images on paper, the algorithm should produce relatively long lines rather than the myriad of short segments that make Meridian appealing.</p>
<p><a href="./img/pulses.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="./img/pulses.jpg" class="img-fluid" width="300"></a> <a href="./img/meridian_638.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="./img/meridian_638.webp" class="img-fluid" width="300"></a></p>
<blockquote class="blockquote">
<p><strong>left</strong> : “Successive pulses from the first pulsar discovered, CP 1919, are here superimposed vertically. The pulses occur every 1.337 seconds. They are caused by rapidly spinning neutron star.” From The Cambridge Encyclopaedia of Astronomy.<br><strong>right</strong> : Meridian #638</p>
</blockquote>
<p>This algorithm feeds on elevation data produced by public structures with different technologies (image analysis, topographical radar, or lidar) and made available for reuse. In this sense, it differs from generative art, where the code is self-sufficient to produce results (see <a href="https://www.artnome.com/news/2018/8/8/why-love-generative-art">why-love-generative-art</a>) This short article explains the underlying logic and software code. A basic reproducible example is available <a href="https://github.com/picasa/generative_examples/blob/8b7709023006dc2456af225bc4ea3393b4cfc5d7/R/gis_ridge.rmd#L23">here</a> to encourage creative experiments.</p>
<p>I won’t comment much on the choice of the R language and the code itself. It’s just that I knew this language for work, and I was curious to see if i could reuse it for other projects. For me, the <a href="https://adv-r.hadley.nz/fp.html">functional</a> programming paradigm makes sense to interact with code, moreover when working in interrupted streaks. The broad data <a href="https://r4ds.had.co.nz/explore-intro.html">exploration</a> workflow resonate with my somewhat reductionist creative approach, especially how the tools for data visualization enable to focus on visual experiments rather code for graphics. I also went for the easy way, thanks to the creators of incredible libraries for (spatial) data processing and graphics. For this project I used {{<a href="https://r-spatial.github.io/stars/">stars</a>}}, {{<a href="https://dplyr.tidyverse.org/">dplyr</a>}}, and {{<a href="https://ggplot2.tidyverse.org/">ggplot2</a>}}.</p>
<p>The algorithm is composed by three main functions, created to be used successively (with the R pipe function, <a href="https://r4ds.hadley.nz/workflow-pipes.html"><code>|&gt;</code></a>). This article broadly illustrates the content of these functions.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">get_features_ridge</span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">gen_dispyr</span><span class="op">(</span>n_ridges <span class="op">=</span> <span class="fl">800</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">plot_ridge</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>
<code>get_features_ridge()</code> is a function of a random seed, and is used to generate the main features of the output (e.g.&nbsp;the location, orientation, style)</li>
<li>
<code>gen_dispyr()</code> uses this set of features to download and process data from a digital elevation model (3D) into a set of lines (2D).</li>
<li>
<code>plot_ridge()</code> renders the processed data into a vector image.</li>
</ol></section><section id="features-generation" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="features-generation">Features generation</h2>
<p>The outputs have only two broad features: a random location in the Pyrénées mountain range and a rendering style, randomly chosen among four methods with a set of probabilities. Most of the visual variability in the outputs is driven by the choice of geographical location, it gives the series a strong link with the subject, but somehow limits the maximum number of obtainable iterations.</p>
<section id="location" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="location">Location</h3>
<p>To get a random location in the Pyrénées mountain range, we first define a sampling region (a 20 km wide buffer around the French-Spain border), and use <code><a href="https://r-spatial.github.io/sf/reference/st_sample.html">sf::st_sample</a></code> to sample a location in this polygon. The code is simplified to sample a mysterious location in a polygon defined by the Andorra borders.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># load a polygon of the Andorra borders</span></span>
<span><span class="va">polygon</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"andorra"</span><span class="op">)</span>, scale <span class="op">=</span> <span class="st">"medium"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fl">2154</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get a sample in the defined polygon </span></span>
<span><span class="va">coord</span> <span class="op">&lt;-</span> <span class="fu">st_sample</span><span class="op">(</span><span class="va">polygon</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/plot_features-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/plot_features-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div>
</div>
</div></div></section><section id="rendering-style" class="level3"><h3 class="anchored" data-anchor-id="rendering-style">Rendering style</h3>
<p>The overall rendering style is impacted by a dozen parameters in the code (e.g.&nbsp;line density, position of lines in the y-axis, amount and position of removed data). Rather than a free exploration of this parameter space, which could lead to heterogeneous outputs, I defined a limited number of fixed sets of parameters. I created four styles, and named them as weather conditions (clear, mist, snow, storm).</p>
<p>Technically nothing complicated, the <code>get_features_ridge()</code> function returns a list of features and associated parameters, later used for the data processing step. The parameters are presented at the moment they are used in the code.</p>
</section></section><section id="data-processing" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="data-processing">Data processing</h2>
<p>This stage uses the previous set of features to download and process data from a digital elevation model (3D) into a set of lines (2D), with distinct processing steps.</p>
<section id="getting-a-realistic-description-of-the-landscape" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="getting-a-realistic-description-of-the-landscape">Getting a realistic description of the landscape</h3>
<p>This step start by actually retrieving the elevation data around the sampled location (a 2x2 km square for the illustration, 20x15 km normally). The <a href="https://github.com/jhollist/elevatr">{{elevatr}}</a> R package makes this step a breeze, but the process is the same when using local high-resolution data.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># get DEM data in a 2x2 km region around the sampled point</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">elevatr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/elevatr/man/get_elev_raster.html">get_elev_raster</a></span><span class="op">(</span></span>
<span>  <span class="va">coord</span>, z <span class="op">=</span> <span class="fl">11</span>, expand <span class="op">=</span> <span class="fl">1E3</span>, clip <span class="op">=</span> <span class="st">"bbox"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># use a heatmap to glance at elevation data</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">st_as_stars</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coord</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"elevation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"lon"</span>, y <span class="op">=</span> <span class="st">"lat"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/plot_sampling-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/plot_sampling-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div>
</div>
</div></div></section><section id="slicing-the-landscape-into-lines" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="slicing-the-landscape-into-lines">Slicing the landscape into lines</h3>
<p>The aim is to process a 3D point set into 2D lines, by computing multiple lines of elevation as a function of longitude, for discrete latitude values. This step is perfectly illustrated by the stacked plot of radio signals presented previously. In our case, each line corresponds to one row in the elevation data (74x74 matrix in the example). Without further modifications, the output is unclear, with a lot of intersecting lines (figure A).</p>
<p>To improve the output readability, but also introduce potential for variations, we process this raw elevation matrix with two actions:</p>
<ul>
<li>shift lines in the y-direction as a function of their rank from the foreground.</li>
<li>delete the line segments that should be hidden by foreground lines with a higher elevation.</li>
</ul>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># parameters</span></span>
<span><span class="va">z_shift</span> <span class="op">=</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># convert DEM from spatial to dataframe format</span></span>
<span><span class="va">df_dem</span> <span class="op">&lt;-</span> <span class="va">dem</span> <span class="op">|&gt;</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, z <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># compute elevation shift as a function of normalized distance</span></span>
<span><span class="va">data_index</span> <span class="op">&lt;-</span> <span class="va">df_dem</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    y_rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,</span>
<span>    y_dist <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">y</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>dz <span class="op">=</span> <span class="va">y_rank</span> <span class="op">*</span> <span class="va">z_shift</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compute shifted elevation values</span></span>
<span><span class="va">df_shift</span> <span class="op">&lt;-</span> <span class="va">df_dem</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">data_index</span>, by <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>xn <span class="op">=</span> <span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, x_rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>zs <span class="op">=</span> <span class="va">z</span> <span class="op">+</span> <span class="va">dz</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/plot_shift-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/plot_shift-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/plot_shift-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/plot_shift-2.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/plot_shift-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/plot_shift-3.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div>
</div>
</div></div><p>The shifting step calculates the difference from the reference elevation as a linear function of its rank from the foreground (figure B). Increasing the slope of this function impacts the perspective, towards a more aerial view of the landscape, eventually reducing the number of intersecting lines (figure C). Using non-linear functions creates unrealistic but interesting perspectives.</p>
<p>At this step, a fast solution to achieve line intersection is by drawing lines with a filled area underneath, starting from the background and thus progressively masking previous polygons (as in painter’s algorithm). This solution is implemented directly in the <a href="https://github.com/wilkelab/ggridges">ggridges</a> R package. But this option is not ideal for creative coding : the hidden lines still exist, which makes vector outputs unusable with a pen-plotter, and it lacks flexibility on the overlaying method.</p>
<div class="cell">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># parameters</span></span>
<span><span class="va">n_lag</span> <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="va">z_threshold</span> <span class="op">=</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># define window functions for multiple lag positions</span></span>
<span><span class="va">list_distance</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"~ . - lag(., n = {1:n_lag})"</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">list_col</span> <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"zs_{1:n_lag}"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove points hidden by foreground ridges :</span></span>
<span><span class="co"># compute lagged elevation difference between successive y for each x </span></span>
<span><span class="co"># replace value by NA when the difference is less than a threshold </span></span>
<span><span class="va">df_ridge</span> <span class="op">&lt;-</span> <span class="va">df_shift</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">zs</span>, .fns <span class="op">=</span> <span class="va">list_distance</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    zn <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="fu">if_any</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">list_col</span><span class="op">)</span>, <span class="op">~</span> <span class="va">.</span> <span class="op">&lt;</span> <span class="va">z_threshold</span><span class="op">)</span> <span class="op">~</span> <span class="cn">NA_real_</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">zs</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span> <span class="fu">all_of</span><span class="op">(</span><span class="va">list_col</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the code above, the intersections between lines are avoided by checking for a minimum distance between a point at a given <em>x</em> position and its neighbourhood along <em>y</em>, and removing the point if any points in the neighbourhood falls below this distance (<em>z_threshold</em> parameter). To avoid computing the distance matrix for all points (74<sup>4</sup>, in this small area), we only check for intersections along a limited range (<em>n_lag</em> parameter, between 0 and 300 y ranks). Increasing the threshold parameter creates clearer distinction between the sides of mountains.</p>
<div class="cell column-body quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-figure quarto-figure-center" style="flex-basis: 33.3%;justify-content: center;">
<figure class="figure"><p><a href="index_files/figure-html/plot_intersect-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="index_files/figure-html/plot_intersect-1.png" class="img-fluid figure-img" width="450"></a></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center" style="flex-basis: 33.3%;justify-content: center;">
<figure class="figure"><p><a href="index_files/figure-html/plot_intersect-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="index_files/figure-html/plot_intersect-2.png" class="img-fluid figure-img" width="450"></a></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center" style="flex-basis: 33.3%;justify-content: center;">
<figure class="figure"><p><a href="index_files/figure-html/plot_intersect-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="index_files/figure-html/plot_intersect-3.png" class="img-fluid figure-img" width="450"></a></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>Line segments are hidden by foreground lines by using polygon masking (left) or distance-based point removal with a null (center) or positive threshold (right).</p>
</blockquote>
<div class="cell">

</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="img/fig_intersection.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="img/fig_intersection.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<blockquote class="blockquote">
<p>Effect of <em>shift</em> (in rows) and <em>threshold</em> (in columns) parameter combination on the landscape rendering (16 km<sup>2</sup>).</p>
</blockquote>
</section><section id="altering-the-lines-with-noise-and-deletion" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="altering-the-lines-with-noise-and-deletion">Altering the lines with noise and deletion</h3>
<p>Finally, the overall aesthetic is obtained by adding noise and discarding data as a function of various attributes (elevation, slope, elevation dispersion). The governing idea was to test how our perception of the landscape changes when most of the initial topographical data is perturbed or removed. Here are four methods, but much is left to explore. The illustration code here is functioning without external call, but highly redundant and surely not optimal, you can conveniently hide it if you feel horrified.</p>
<div class="cell">

</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="img/fig_styles.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="img/fig_styles.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<blockquote class="blockquote">
<p>Four data processing methods, all based on filtering points and adding noise, and named after weather conditions (clear, mist, snow, storm).</p>
</blockquote>
<section id="clear" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="clear">clear</h4>
<p>For each ridgeline, the method samples 50 % of the points and adds moderate jitter on elevation values.</p>
<div class="cell page-columns page-full">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># parameters</span></span>
<span><span class="va">z_remove</span> <span class="op">=</span> <span class="fl">0.5</span>      <span class="co"># proportion of points to remove</span></span>
<span><span class="va">z_jitter</span> <span class="op">=</span> <span class="fl">4</span>        <span class="co"># amount of jitter in elevation values</span></span>
<span></span>
<span><span class="co"># randomly sample a proportion of points in a line, jitter their y-position.</span></span>
<span><span class="va">df_plot</span> <span class="op">&lt;-</span> <span class="va">df_ridge</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">z_remove</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>zn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">zn</span>, amount <span class="op">=</span> <span class="va">z_jitter</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot output</span></span>
<span><span class="va">df_plot</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">zn</span>, group <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/code_clear-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="index_files/figure-html/code_clear-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div></div></div>
</section><section id="mist" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="mist">mist</h4>
<p>Same base as the previous method. In addition, when below an elevation threshold, lines are smoothed and points are randomly removed.</p>
<div class="cell page-columns page-full">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># functions</span></span>
<span></span>
<span><span class="co"># add a proportion of missing values in a vector</span></span>
<span><span class="va">sample_missing</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, size <span class="op">=</span> <span class="va">p</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">s</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># parameters</span></span>
<span><span class="va">x_size</span> <span class="op">=</span> <span class="fl">10</span>         <span class="co"># window of the rolling average </span></span>
<span><span class="va">z_limit</span> <span class="op">=</span> <span class="fl">0.5</span>       <span class="co"># quantile value determining the elevation threshold</span></span>
<span><span class="va">z_remove</span> <span class="op">=</span> <span class="fl">0.5</span>      <span class="co"># proportion of points to remove in lines</span></span>
<span><span class="va">z_missing</span> <span class="op">=</span> <span class="fl">0.2</span>     <span class="co"># proportion of missing value to add</span></span>
<span><span class="va">z_jitter</span> <span class="op">=</span> <span class="fl">4</span>        <span class="co"># amount of jitter in elevation values</span></span>
<span></span>
<span><span class="co"># calculate elevation cut</span></span>
<span><span class="va">z_cut</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df_ridge</span><span class="op">$</span><span class="va">z</span>, <span class="va">z_limit</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># smooth lines with a rolling mean </span></span>
<span><span class="va">df_smooth</span> <span class="op">&lt;-</span> <span class="va">df_ridge</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    zm <span class="op">=</span> <span class="fu">RcppRoll</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean</a></span><span class="op">(</span><span class="va">zn</span>, n <span class="op">=</span> <span class="va">x_size</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    zm <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">zm</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">x_rank</span> <span class="op">&lt;</span> <span class="va">x_size</span><span class="op">/</span><span class="fl">2</span> <span class="op">|</span> <span class="va">x_rank</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x_rank</span><span class="op">)</span> <span class="op">-</span> <span class="va">x_size</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">zn</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">zm</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># remove data as a function of elevation, jitter y-position above a threshold   </span></span>
<span><span class="va">df_plot</span> <span class="op">&lt;-</span> <span class="va">df_smooth</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">z_remove</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    zn <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="op">(</span><span class="va">z</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">z_cut</span> <span class="op">-</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="fu">sample_missing</span><span class="op">(</span><span class="va">zm</span>, p <span class="op">=</span> <span class="va">z_missing</span> <span class="op">+</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>      <span class="op">(</span><span class="va">z</span> <span class="op">&lt;</span> <span class="va">z_cut</span><span class="op">)</span>         <span class="op">~</span> <span class="fu">sample_missing</span><span class="op">(</span><span class="va">zm</span>, p <span class="op">=</span> <span class="va">z_missing</span><span class="op">)</span>,</span>
<span>      <span class="cn">TRUE</span>                <span class="op">~</span> <span class="va">zn</span><span class="op">)</span>,</span>
<span>    zn <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">z</span> <span class="op">&gt;</span> <span class="va">z_cut</span>, <span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">zn</span>, amount <span class="op">=</span> <span class="va">z_jitter</span><span class="op">)</span>, <span class="va">zn</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="co"># plot output</span></span>
<span><span class="va">df_plot</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">zn</span>, group <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/code_mist-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="index_files/figure-html/code_mist-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div></div></div>
</section><section id="snow" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="snow">snow</h4>
<p>Same base as the previous method, but the data removal is also a function of a slope threshold.</p>
<div class="cell page-columns page-full">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># parameters</span></span>
<span><span class="va">x_size</span> <span class="op">=</span> <span class="fl">5</span>          <span class="co"># window of the rolling average </span></span>
<span><span class="va">z_limit</span> <span class="op">=</span> <span class="fl">0.7</span>       <span class="co"># quantile value determining the elevation threshold</span></span>
<span><span class="va">z_remove</span> <span class="op">=</span> <span class="fl">0.5</span>      <span class="co"># proportion of points to remove in lines</span></span>
<span><span class="va">z_missing</span> <span class="op">=</span> <span class="fl">0.6</span>     <span class="co"># proportion of missing value to add</span></span>
<span><span class="va">z_jitter</span> <span class="op">=</span> <span class="fl">4</span>        <span class="co"># amount of jitter in elevation values</span></span>
<span></span>
<span><span class="co"># calculate elevation cut</span></span>
<span><span class="va">z_cut</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df_ridge</span><span class="op">$</span><span class="va">z</span>, <span class="va">z_limit</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate local slope and remove points for flat areas</span></span>
<span><span class="va">df_filter</span> <span class="op">&lt;-</span> <span class="va">df_ridge</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">x_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>      z_slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span></span>
<span>        <span class="op">(</span><span class="va">zn</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">zn</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">xn</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">xn</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>      z_slope <span class="op">=</span> <span class="fu">RcppRoll</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean</a></span><span class="op">(</span><span class="va">z_slope</span>, n <span class="op">=</span> <span class="va">x_size</span>, fill <span class="op">=</span> <span class="cn">NA_real_</span><span class="op">)</span>,</span>
<span>      zn <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">z_slope</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">zn</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove data as a function of slope and elevation   </span></span>
<span><span class="va">df_plot</span> <span class="op">&lt;-</span> <span class="va">df_filter</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">z_remove</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    zn <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="op">(</span><span class="va">z</span> <span class="op">&gt;</span> <span class="va">z_cut</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">z_slope</span> <span class="op">&lt;</span> <span class="fl">60</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>         <span class="op">~</span></span>
<span>        <span class="fu">sample_missing</span><span class="op">(</span><span class="va">zn</span>, p <span class="op">=</span> <span class="va">z_missing</span><span class="op">)</span>,</span>
<span>      <span class="op">(</span><span class="va">z</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">z_cut</span> <span class="op">-</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">z_slope</span> <span class="op">&lt;</span> <span class="fl">60</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span> <span class="op">~</span></span>
<span>        <span class="fu">sample_missing</span><span class="op">(</span><span class="va">zn</span>, p <span class="op">=</span> <span class="va">z_missing</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>      <span class="cn">TRUE</span>                                     <span class="op">~</span></span>
<span>        <span class="va">zn</span><span class="op">)</span>,</span>
<span>    zn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">zn</span>, amount <span class="op">=</span> <span class="va">z_jitter</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="co"># plot output</span></span>
<span><span class="va">df_plot</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">zn</span>, group <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/code_snow-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="index_files/figure-html/code_snow-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div></div></div>
</section><section id="storm" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="storm">storm</h4>
<p>Whole strips of lines are removed when the elevation variation is below a threshold. Additionally, an important jitter is added as a function of local slope value.</p>
<div class="cell page-columns page-full">
<details><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># functions</span></span>
<span></span>
<span><span class="co"># scale the input vector with an exponential function</span></span>
<span><span class="va">f_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">a</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">b</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">scale</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">scale</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="va">x</span> <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">x</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="kw">else</span> <span class="va">x</span></span>
<span>  <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">k</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">b</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># find multiple non-consecutive minima in a vector (this is awful) </span></span>
<span><span class="va">get_extremum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">w</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">delta</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">method</span> <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>      y_smooth <span class="op">=</span> <span class="fu">RcppRoll</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean</a></span><span class="op">(</span><span class="va">y_raw</span>, n <span class="op">=</span> <span class="va">w</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">y_smooth</span> <span class="op">-</span> <span class="va">y_raw</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">delta</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span></span>
<span>      <span class="fu">if_else</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">y_raw</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">y_raw</span> <span class="op">&amp;</span> <span class="fu">lead</span><span class="op">(</span><span class="va">y_raw</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">y_raw</span>,</span>
<span>        <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">slice_min</span><span class="op">(</span><span class="va">y_raw</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># parameters</span></span>
<span><span class="va">y_range</span> <span class="op">=</span> <span class="fl">5</span>        <span class="co"># number of ridges to remove around selected ones</span></span>
<span><span class="va">x_size</span> <span class="op">=</span> <span class="fl">5</span>          <span class="co"># window of the rolling average </span></span>
<span><span class="va">z_remove</span> <span class="op">=</span> <span class="fl">0.5</span>      <span class="co"># proportion of points to remove in lines</span></span>
<span><span class="va">z_jitter</span> <span class="op">=</span> <span class="fl">4</span>        <span class="co"># amount of jitter in elevation values</span></span>
<span></span>
<span></span>
<span><span class="co"># get maximum number of ridgelines</span></span>
<span><span class="va">n_ridge_max</span> <span class="op">&lt;-</span> <span class="va">df_ridge</span> <span class="op">|&gt;</span> <span class="fu">distinct</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate local slope and remove points for flat areas</span></span>
<span><span class="va">df_filter</span> <span class="op">&lt;-</span> <span class="va">df_ridge</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">x_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>      z_slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span></span>
<span>        <span class="op">(</span><span class="va">zn</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">zn</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">xn</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">xn</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>      z_slope <span class="op">=</span> <span class="fu">RcppRoll</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppRoll/man/RcppRoll-exports.html">roll_mean</a></span><span class="op">(</span><span class="va">z_slope</span>, n <span class="op">=</span> <span class="va">x_size</span>, fill <span class="op">=</span> <span class="cn">NA_real_</span><span class="op">)</span>,</span>
<span>      zn <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">z_slope</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA_real_</span>, <span class="va">zn</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compute potential distortion on z-axis as a function of local slope on x-axis</span></span>
<span><span class="co"># jitter by sampling in this distortion level for each point</span></span>
<span><span class="va">df_sample</span> <span class="op">&lt;-</span> <span class="va">df_filter</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">z_remove</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>z_jitter <span class="op">=</span> <span class="fu">f_exp</span><span class="op">(</span><span class="va">z_slope</span>, k <span class="op">=</span> <span class="fl">3.5</span>, a <span class="op">=</span> <span class="fl">0.3</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="va">z_jitter</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    z_jitter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="va">z_jitter</span>, <span class="va">z_jitter</span><span class="op">)</span>,</span>
<span>    zn <span class="op">=</span> <span class="va">zn</span> <span class="op">+</span> <span class="va">z_jitter</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># get ridges position with low elevation variance</span></span>
<span><span class="va">index_strip</span> <span class="op">&lt;-</span> <span class="va">df_sample</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>y_raw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">z</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">get_extremum</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">z_remove</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span>, w <span class="op">=</span> <span class="fl">30</span>, delta <span class="op">=</span> <span class="fl">3</span>, method <span class="op">=</span> <span class="st">"min"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">between</span><span class="op">(</span><span class="va">y_rank</span>, <span class="op">(</span><span class="va">y_range</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span>, <span class="op">(</span><span class="va">n_ridge_max</span> <span class="op">-</span> <span class="va">y_range</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove strips of ridges based on previous index</span></span>
<span><span class="va">df_plot</span> <span class="op">&lt;-</span> <span class="fu">anti_join</span><span class="op">(</span></span>
<span>  <span class="va">df_sample</span>,</span>
<span>  <span class="va">df_sample</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">distinct</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">slice</span><span class="op">(</span></span>
<span>      <span class="va">index_strip</span> <span class="op">|&gt;</span> <span class="fu">pull</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">map</span><span class="op">(</span><span class="op">~</span> <span class="op">(</span><span class="va">.x</span> <span class="op">-</span> <span class="va">y_range</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">.x</span> <span class="op">+</span> <span class="va">y_range</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">flatten_int</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"y_rank"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot output</span></span>
<span><span class="va">df_plot</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">zn</span>, group <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/code_storm-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="index_files/figure-html/code_storm-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div></div></div>
</section></section></section><section id="rendering" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="rendering">Rendering</h2>
<p>This step is essentially playing on opacity (either constant or variable along a line) and on the doubling of the line strokes to emulate pencil lines. Thanks to the R graphical devices, the same object can be exported to bitmap or vector files.</p>
<section id="default" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="default">default</h4>
<div class="cell page-columns page-full">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># parameters</span></span>
<span><span class="va">z_remove</span> <span class="op">=</span> <span class="fl">0.5</span>      <span class="co"># proportion of points to remove</span></span>
<span><span class="va">z_jitter</span> <span class="op">=</span> <span class="fl">4</span>        <span class="co"># amount of jitter in elevation values</span></span>
<span><span class="va">p_alpha</span> <span class="op">=</span> <span class="fl">0.5</span>       <span class="co"># mean opacity value</span></span>
<span></span>
<span><span class="co"># randomly sample a proportion of points in a line, jitter their y-position.</span></span>
<span><span class="va">df_plot</span> <span class="op">&lt;-</span> <span class="va">df_ridge</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">z_remove</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>zn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">zn</span>, amount <span class="op">=</span> <span class="va">z_jitter</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># render lines with a constant alpha value</span></span>
<span><span class="va">df_plot</span> <span class="op">|&gt;</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">zn</span>, group <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">p_alpha</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/code_plain-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="index_files/figure-html/code_plain-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div></div></div>
</section><section id="variable-opacity" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="variable-opacity">variable opacity</h4>
<div class="cell page-columns page-full">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># parameters</span></span>
<span><span class="va">p_alpha_sd</span> <span class="op">=</span> <span class="fl">0.10</span>   <span class="co"># dispersion of opacity value </span></span>
<span></span>
<span><span class="co"># render line with an alpha value sampled from a Gaussian distribution</span></span>
<span><span class="va">df_plot</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>z_alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, <span class="va">p_alpha</span>, <span class="va">p_alpha_sd</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">zn</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">y_rank</span>, alpha <span class="op">=</span> <span class="va">z_alpha</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_alpha_identity</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/code_pencil-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="index_files/figure-html/code_pencil-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div></div></div>
</section><section id="variable-opacity-and-double-strokes" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="variable-opacity-and-double-strokes">variable opacity and double strokes</h4>
<div class="cell page-columns page-full">
<details open=""><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># functions</span></span>
<span><span class="co"># fit a polynomial determined by one or more numerical predictors</span></span>
<span><span class="va">f_loess</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">span</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># do not fit model if less than n non-na values</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">zn</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span><span class="op">(</span><span class="va">zn</span> <span class="op">~</span> <span class="va">xn</span>, data <span class="op">=</span> <span class="va">data</span>, na.action <span class="op">=</span> <span class="va">na.exclude</span>, span <span class="op">=</span> <span class="va">span</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># parameters</span></span>
<span><span class="va">p_span</span> <span class="op">=</span> <span class="fl">0.5</span>      <span class="co"># span of the smoothing model (smaller fits the line)</span></span>
<span><span class="va">p_length</span> <span class="op">=</span> <span class="fl">25</span>     <span class="co"># minimal line length to apply the smoothing model</span></span>
<span></span>
<span><span class="co"># render line with two strokes, and variable alpha</span></span>
<span><span class="va">df_smooth</span> <span class="op">&lt;-</span> <span class="va">df_plot</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y_rank</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">nest</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>z_smooth <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span> <span class="fu">f_loess</span><span class="op">(</span><span class="va">.</span>, span <span class="op">=</span> <span class="va">p_span</span>, n <span class="op">=</span> <span class="va">p_length</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">z_smooth</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_plot</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>z_alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, <span class="va">p_alpha</span>, <span class="va">p_alpha_sd</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">xn</span>, <span class="va">zn</span>, group <span class="op">=</span> <span class="va">y_rank</span>, alpha <span class="op">=</span> <span class="va">z_alpha</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_smooth</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">xn</span>, <span class="va">z_smooth</span>, group <span class="op">=</span> <span class="va">y_rank</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="va">p_alpha</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_alpha_identity</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="index_files/figure-html/code_stroke-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="index_files/figure-html/code_stroke-1.png" class="img-fluid figure-img" width="600"></a></p>
</figure>
</div>
</div></div></div>
</section></section><section id="iterations" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="iterations">Iterations</h2>
<p>These outputs were generated with the algorithm described previously, but based on a random location in the whole Pyrenees range (with a larger geographical area - 15x20 km, and a random cardinal orientation), and a random aesthetic style among the four presented ones. The algorithm can handle about 1000 iterations before repeating information (about 70 distinct 300 km2 regions with limited overlapping, 4 orientations, and 4 styles).</p>
<blockquote class="blockquote">
<p>An example of 32 random iterations from this algorithm.</p>
</blockquote>
<div class="column-screen-inset-right gallery-grid">
<div>
<a href="img/gallery/dispyr_09.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_09.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_100.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_100.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_102.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_102.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_104.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_104.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_125.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_125.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_127.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_127.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_145.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_145.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_173.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_173.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_197.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_197.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_199.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_199.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_228.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_228.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_241.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_241.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_266.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_266.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_312.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_312.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_316.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_316.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_320.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_320.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_354.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_354.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_359.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_359.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_377.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_377.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_398.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_398.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_402.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_402.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_434.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_434.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_436.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_436.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_438.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_438.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_456.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_456.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_47.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_47.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_475.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_475.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_480.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_480.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_488.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_488.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_56.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_56.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_62.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_62.jpg" class="img-fluid"></a>
</div>
<div>
<a href="img/gallery/dispyr_69.jpg" class="lightbox" data-gallery="default"><img src="img/gallery/dispyr_69.jpg" class="img-fluid"></a>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","closeEffect":"zoom","loop":true,"openEffect":"zoom","selector":".lightbox"});</script>


</body></html>